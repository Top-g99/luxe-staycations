(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[743,8991],{53082:(e,t,a)=>{Promise.resolve().then(a.bind(a,79852))},68991:(e,t,a)=>{"use strict";a.r(t),a.d(t,{DataManager:()=>i,bookingManager:()=>l,callbackManager:()=>g,couponManagerInstance:()=>p,dealBannerManager:()=>d,dealManager:()=>m,destinationManager:()=>u,heroBackgroundManager:()=>h,masterDataManager:()=>y,mockBookings:()=>r,mockProperties:()=>n,mockUsers:()=>s,offersBannerManager:()=>x,propertyManager:()=>o,userManager:()=>c});let n=[{id:"1",name:"Luxury Villa 1",description:"Beautiful luxury villa with ocean view",price:500,location:"Goa",type:"villa",amenities:["pool","wifi","ac"],images:["/images/villa1.jpg"],featured:!0,available:!0,max_guests:8,bedrooms:4,bathrooms:3,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}],r=[{id:"1",property_id:"1",user_id:"1",guestName:"John Doe",guestEmail:"john@example.com",guestPhone:"+1234567890",checkIn:"2024-01-01",checkOut:"2024-01-05",guests:4,totalAmount:2e3,status:"confirmed",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}],s=[{id:"1",email:"user@example.com",name:"John Doe",phone:"+1234567890",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}];class i{async initialize(){return Promise.resolve()}async getAll(){return this.data}async getById(e){return this.data.find(t=>t.id===e)||null}async create(e){return this.data.push(e),e}async update(e,t){let a=this.data.findIndex(t=>t.id===e);return -1!==a?(this.data[a]={...this.data[a],...t},this.data[a]):null}async delete(e){let t=this.data.findIndex(t=>t.id===e);return -1!==t&&(this.data.splice(t,1),!0)}async redeemCoupon(e,t,a,n,r){return console.log("Redeeming coupon:",{code:e,amount:t,bookingId:a,email:n,name:r}),{success:!0,discount:0}}async validateCoupon(e,t){return console.log("Validating coupon:",{code:e,amount:t}),{isValid:!0,discount:0,message:"Coupon is valid"}}async getFeatured(){return this.data.filter(e=>!0===e.featured)}async getActive(){return this.data.filter(e=>!0===e.isActive)}subscribe(e){return()=>{}}async initializeAll(){await this.getAll()}getStats(){return{total:this.data.length,loading:!1,initialized:!0}}async clear(){this.data=[]}constructor(e){this.data=[],this.tableName=e}}let o=new i("properties"),l=new i("bookings"),c=new i("users"),d=new i("dealBanners"),u=new i("destinations"),h=new i("heroBackgrounds"),m=new i("deals"),x=new i("offersBanners"),g=new i("callbacks"),p=new i("coupons"),y=new i("masterData")},79852:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>er});var n=a(95155),r=a(12115),s=a(97322),i=a(23315),o=a(78010),l=a(70690),c=a(80851),d=a(95844),u=a(71908),h=a(64246),m=a(33077),x=a(29767),g=a(84578),p=a(9562),y=a(21067),f=a(80422),A=a(43568),j=a(20063),b=a(85903),v=a(68991),k=a(52641),I=a(95436),w=a(88450),S=a(86973),C=a(99944),N=a(22822),D=a(57430),P=a(30285),E=a(54741),O=a(61205),M=a(96917),R=a(65629),W=a(62291);function B(e){let{guestInfo:t,onGuestInfoChange:a}=e;return(0,n.jsxs)(c.A,{sx:{p:3},children:[(0,n.jsx)(i.A,{variant:"h6",sx:{mb:3,fontWeight:600,color:"#5a3d35"},children:"Guest Information"}),(0,n.jsxs)(m.Ay,{container:!0,spacing:3,children:[(0,n.jsx)(m.Ay,{item:!0,xs:12,children:(0,n.jsx)(i.A,{variant:"subtitle1",sx:{mb:2,fontWeight:600,color:"#d97706"},children:"Personal Details"})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,n.jsx)(p.A,{fullWidth:!0,label:"First Name *",value:t.firstName,onChange:e=>a("firstName",e.target.value),required:!0,InputProps:{startAdornment:(0,n.jsx)(D.A,{sx:{color:"text.secondary",mr:1}})}})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,n.jsx)(p.A,{fullWidth:!0,label:"Last Name *",value:t.lastName,onChange:e=>a("lastName",e.target.value),required:!0,InputProps:{startAdornment:(0,n.jsx)(D.A,{sx:{color:"text.secondary",mr:1}})}})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,n.jsx)(p.A,{fullWidth:!0,label:"Email Address *",type:"email",value:t.email,onChange:e=>a("email",e.target.value),required:!0,InputProps:{startAdornment:(0,n.jsx)(P.A,{sx:{color:"text.secondary",mr:1}})}})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,n.jsx)(p.A,{fullWidth:!0,label:"Phone Number *",value:t.phone,onChange:e=>a("phone",e.target.value),required:!0,InputProps:{startAdornment:(0,n.jsx)(E.A,{sx:{color:"text.secondary",mr:1}})}})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,children:(0,n.jsx)(i.A,{variant:"subtitle1",sx:{mb:2,mt:2,fontWeight:600,color:"#d97706"},children:"Address Information"})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,children:(0,n.jsx)(p.A,{fullWidth:!0,label:"Address",value:t.address||"",onChange:e=>a("address",e.target.value),multiline:!0,rows:2,InputProps:{startAdornment:(0,n.jsx)(O.A,{sx:{color:"text.secondary",mr:1,mt:1}})}})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,n.jsxs)(k.A,{fullWidth:!0,children:[(0,n.jsx)(I.A,{children:"City"}),(0,n.jsxs)(w.A,{value:t.city||"",onChange:e=>a("city",e.target.value),label:"City",children:[(0,n.jsx)(S.A,{value:"",children:"Select a city"}),["Mumbai","Delhi","Bangalore","Hyderabad","Chennai","Kolkata","Pune","Ahmedabad","Jaipur","Surat","Lucknow","Kanpur","Nagpur","Indore","Thane","Bhopal","Visakhapatnam","Pimpri-Chinchwad","Patna","Vadodara","Ghaziabad","Ludhiana","Agra","Nashik","Faridabad","Meerut","Rajkot","Kalyan-Dombivali","Vasai-Virar","Varanasi","Srinagar","Aurangabad","Dhanbad","Amritsar","Allahabad","Ranchi","Howrah","Coimbatore","Jabalpur","Gwalior","Vijayawada","Jodhpur","Madurai","Raipur","Kota","Guwahati","Chandigarh","Solapur","Hubli-Dharwad","Bareilly","Moradabad","Mysore","Gurgaon","Aligarh","Jalandhar","Tiruchirappalli","Bhubaneswar","Salem","Warangal","Mira-Bhayandar","Thiruvananthapuram","Bhiwandi","Saharanpur","Gorakhpur","Guntur","Bikaner","Amravati","Noida","Jamshedpur","Bhilai","Cuttack","Firozabad","Kochi","Nellore","Bhavnagar","Dehradun","Durgapur","Asansol","Rourkela","Nanded","Kolhapur","Ajmer","Akola","Gulbarga","Jamnagar","Ujjain","Loni","Siliguri","Jhansi","Ulhasnagar","Jammu","Sangli-Miraj","Mangalore","Erode","Belgaum","Ambattur","Tirunelveli","Malegaon","Gaya","Jalgaon","Udaipur","Maheshtala"].map(e=>(0,n.jsx)(S.A,{value:e,children:e},e))]})]})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,n.jsxs)(k.A,{fullWidth:!0,children:[(0,n.jsx)(I.A,{children:"Country"}),(0,n.jsxs)(w.A,{value:t.country||"",onChange:e=>a("country",e.target.value),label:"Country",children:[(0,n.jsx)(S.A,{value:"",children:"Select a country"}),["India","United States","United Kingdom","Canada","Australia","Germany","France","Japan","Singapore","United Arab Emirates","Saudi Arabia","Qatar","Kuwait","Oman","Bahrain"].map(e=>(0,n.jsx)(S.A,{value:e,children:e},e))]})]})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,children:(0,n.jsx)(i.A,{variant:"subtitle1",sx:{mb:2,mt:2,fontWeight:600,color:"#d97706"},children:"Special Requests"})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,children:(0,n.jsx)(p.A,{fullWidth:!0,label:"Special Requests or Preferences",value:t.specialRequests||"",onChange:e=>a("specialRequests",e.target.value),multiline:!0,rows:3,placeholder:"Any special requests, dietary preferences, accessibility needs, or other requirements...",InputProps:{startAdornment:(0,n.jsx)(M.A,{sx:{color:"text.secondary",mr:1,mt:1}})}})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,children:(0,n.jsx)(i.A,{variant:"subtitle1",sx:{mb:2,mt:3,fontWeight:600,color:"#d97706"},children:"Join Luxe Rewards (Optional)"})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,children:(0,n.jsx)(x.A,{sx:{background:"linear-gradient(135deg, #5a3d35 0%, #d97706 100%)",color:"white",mb:2},children:(0,n.jsxs)(g.A,{children:[(0,n.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",mb:2},children:[(0,n.jsx)(R.A,{sx:{fontSize:32,mr:2}}),(0,n.jsxs)(c.A,{children:[(0,n.jsx)(i.A,{variant:"h6",sx:{fontWeight:600},children:"Unlock Exclusive Benefits"}),(0,n.jsx)(i.A,{variant:"body2",sx:{opacity:.9},children:"Earn points, get member-only rates, and enjoy VIP services"})]})]}),(0,n.jsxs)(m.Ay,{container:!0,spacing:2,children:[(0,n.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,n.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,n.jsx)(W.A,{sx:{fontSize:16,mr:1,color:"#FFD700"}}),(0,n.jsx)(i.A,{variant:"body2",children:"Earn 1 point per ₹100 spent"})]})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,n.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,n.jsx)(W.A,{sx:{fontSize:16,mr:1,color:"#FFD700"}}),(0,n.jsx)(i.A,{variant:"body2",children:"Priority booking access"})]})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,n.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,n.jsx)(W.A,{sx:{fontSize:16,mr:1,color:"#FFD700"}}),(0,n.jsx)(i.A,{variant:"body2",children:"Exclusive member rates"})]})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,n.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",mb:1},children:[(0,n.jsx)(W.A,{sx:{fontSize:16,mr:1,color:"#FFD700"}}),(0,n.jsx)(i.A,{variant:"body2",children:"VIP concierge services"})]})})]})]})})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,children:(0,n.jsx)(C.A,{control:(0,n.jsx)(N.A,{checked:t.createLoyaltyAccount||!1,onChange:e=>a("createLoyaltyAccount",e.target.checked),sx:{color:"#d97706"}}),label:(0,n.jsx)(i.A,{variant:"body1",sx:{fontWeight:500},children:"Yes, I want to join Luxe Rewards and start earning points on this booking"})})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,children:(0,n.jsx)(C.A,{control:(0,n.jsx)(N.A,{checked:t.subscribeToNewsletter||!1,onChange:e=>a("subscribeToNewsletter",e.target.checked),sx:{color:"#d97706"}}),label:(0,n.jsx)(i.A,{variant:"body2",sx:{color:"text.secondary"},children:"Subscribe to our newsletter for exclusive offers and updates"})})}),t.createLoyaltyAccount&&(0,n.jsx)(m.Ay,{item:!0,xs:12,children:(0,n.jsx)(o.A,{severity:"info",sx:{mt:2},children:(0,n.jsxs)(i.A,{variant:"body2",children:[(0,n.jsx)("strong",{children:"Great choice!"})," After your booking is confirmed, you'll receive an email to set up your Luxe Rewards account. You'll earn points on this booking and unlock exclusive benefits for future stays."]})})})]})]})}var z=a(28548),T=a(73741),_=a(36944),L=a(75854),F=a(78784),q=a(23123);function J(e){var t,a;let{guestInfo:r,bookingDetails:s,property:o}=e,l=e=>new Date(e).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),d=(()=>{let e=new Date(s.checkIn);return Math.ceil(Math.abs(new Date(s.checkOut).getTime()-e.getTime())/864e5)})();return(0,n.jsxs)(c.A,{sx:{p:3},children:[(0,n.jsx)(i.A,{variant:"h6",sx:{mb:3,fontWeight:600,color:"#5a3d35"},children:"Booking Summary"}),(0,n.jsxs)(m.Ay,{container:!0,spacing:3,children:[(0,n.jsx)(m.Ay,{item:!0,xs:12,children:(0,n.jsx)(x.A,{sx:{mb:3,border:"2px solid #f3f4f6"},children:(0,n.jsxs)(g.A,{children:[(0,n.jsxs)(i.A,{variant:"h6",sx:{mb:2,fontWeight:600,color:"#d97706",display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(_.A,{}),"Property Details"]}),(0,n.jsxs)(m.Ay,{container:!0,spacing:2,children:[(0,n.jsx)(m.Ay,{item:!0,xs:12,sm:4,children:(0,n.jsx)(c.A,{component:"img",src:(null==(t=o.images)?void 0:t[0])||"",alt:o.name,sx:{width:"100%",height:200,objectFit:"cover",borderRadius:2}})}),(0,n.jsxs)(m.Ay,{item:!0,xs:12,sm:8,children:[(0,n.jsx)(i.A,{variant:"h5",sx:{fontWeight:600,mb:1},children:o.name}),(0,n.jsxs)(i.A,{variant:"body1",sx:{color:"text.secondary",mb:2,display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(O.A,{sx:{fontSize:16}}),o.location]}),(0,n.jsx)(i.A,{variant:"body2",sx:{mb:2},children:o.description}),(0,n.jsx)(c.A,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:null==(a=o.amenities)?void 0:a.slice(0,4).map((e,t)=>(0,n.jsx)(z.A,{label:e,size:"small",variant:"outlined"},t))})]})]})]})})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,md:6,children:(0,n.jsx)(x.A,{sx:{height:"100%",border:"2px solid #f3f4f6"},children:(0,n.jsxs)(g.A,{children:[(0,n.jsxs)(i.A,{variant:"h6",sx:{mb:2,fontWeight:600,color:"#d97706",display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(D.A,{}),"Guest Information"]}),(0,n.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[(0,n.jsxs)(T.A,{sx:{bgcolor:"#d97706",width:56,height:56},children:[r.firstName.charAt(0),r.lastName.charAt(0)]}),(0,n.jsxs)(c.A,{children:[(0,n.jsxs)(i.A,{variant:"h6",sx:{fontWeight:600},children:[r.firstName," ",r.lastName]}),(0,n.jsx)(i.A,{variant:"body2",sx:{color:"text.secondary"},children:"Guest"})]})]}),(0,n.jsxs)(c.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,n.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(P.A,{sx:{fontSize:16,color:"text.secondary"}}),(0,n.jsx)(i.A,{variant:"body2",children:r.email})]}),(0,n.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(E.A,{sx:{fontSize:16,color:"text.secondary"}}),(0,n.jsx)(i.A,{variant:"body2",children:r.phone})]}),r.address&&(0,n.jsxs)(c.A,{sx:{display:"flex",alignItems:"flex-start",gap:1},children:[(0,n.jsx)(O.A,{sx:{fontSize:16,color:"text.secondary",mt:.2}}),(0,n.jsxs)(i.A,{variant:"body2",children:[r.address,r.city&&", ".concat(r.city),r.country&&", ".concat(r.country)]})]}),r.specialRequests&&(0,n.jsxs)(c.A,{sx:{display:"flex",alignItems:"flex-start",gap:1},children:[(0,n.jsx)(M.A,{sx:{fontSize:16,color:"text.secondary",mt:.2}}),(0,n.jsxs)(i.A,{variant:"body2",sx:{fontStyle:"italic"},children:['"',r.specialRequests,'"']})]})]})]})})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,md:6,children:(0,n.jsx)(x.A,{sx:{height:"100%",border:"2px solid #f3f4f6"},children:(0,n.jsxs)(g.A,{children:[(0,n.jsxs)(i.A,{variant:"h6",sx:{mb:2,fontWeight:600,color:"#d97706",display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(L.A,{}),"Stay Details"]}),(0,n.jsxs)(c.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,n.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)(i.A,{variant:"body2",sx:{color:"text.secondary"},children:"Check-in"}),(0,n.jsx)(i.A,{variant:"body1",sx:{fontWeight:600},children:l(s.checkIn)})]}),(0,n.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)(i.A,{variant:"body2",sx:{color:"text.secondary"},children:"Check-out"}),(0,n.jsx)(i.A,{variant:"body1",sx:{fontWeight:600},children:l(s.checkOut)})]}),(0,n.jsx)(y.A,{}),(0,n.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsxs)(i.A,{variant:"body2",sx:{color:"text.secondary",display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(F.A,{sx:{fontSize:16}}),"Guests"]}),(0,n.jsxs)(i.A,{variant:"body1",sx:{fontWeight:600},children:[s.guests," ",1===parseInt(s.guests)?"Guest":"Guests"]})]}),(0,n.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)(i.A,{variant:"body2",sx:{color:"text.secondary"},children:"Duration"}),(0,n.jsxs)(i.A,{variant:"body1",sx:{fontWeight:600},children:[d," ",1===d?"Night":"Nights"]})]})]})]})})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,children:(0,n.jsx)(x.A,{sx:{border:"2px solid #f3f4f6"},children:(0,n.jsxs)(g.A,{children:[(0,n.jsxs)(i.A,{variant:"h6",sx:{mb:2,fontWeight:600,color:"#d97706",display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(q.A,{}),"Pricing Summary"]}),(0,n.jsxs)(c.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,n.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)(i.A,{variant:"body1",children:"Per Night Rate"}),(0,n.jsxs)(i.A,{variant:"body1",children:["₹",o.price.toLocaleString()]})]}),(0,n.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)(i.A,{variant:"body1",children:"Number of Nights"}),(0,n.jsx)(i.A,{variant:"body1",children:d})]}),(0,n.jsx)(y.A,{}),(0,n.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsx)(i.A,{variant:"h6",sx:{fontWeight:600,color:"#d97706"},children:"Total Amount"}),(0,n.jsxs)(i.A,{variant:"h6",sx:{fontWeight:600,color:"#d97706"},children:["₹",s.total.toLocaleString()]})]}),(0,n.jsx)(z.A,{label:"Payment Pending",color:"warning",variant:"outlined",sx:{alignSelf:"flex-start"}})]})]})})})]})]})}var U=a(9839),G=a(66591),Y=a(75656),H=a(36741),V=a(40596),K=a(22006),Z=a(14041),X=a(80412),Q=a(95704);class ${checkConfiguration(){let e=Q.env.NEXT_PUBLIC_RAZORPAY_KEY_ID,t=Q.env.RAZORPAY_KEY_SECRET;e&&t?(this.isConfigured=!0,this.config={key:e,secret:t}):(console.warn("Razorpay configuration not found. Please set NEXT_PUBLIC_RAZORPAY_KEY_ID and RAZORPAY_KEY_SECRET environment variables."),this.isConfigured=!1)}isRazorpayConfigured(){return this.isConfigured}configure(e){this.isConfigured=!0,this.config={key:e.keyId,secret:e.keySecret},console.log("RazorpayService: Configuration updated")}async initializePayment(e){if(!this.isConfigured)throw Error("Razorpay is not configured");return new Promise((t,a)=>{try{let n={key:this.config.key,amount:100*e.amount,currency:e.currency,name:e.name,description:e.description,order_id:e.orderId,prefill:{name:e.customerName,email:e.customerEmail,contact:e.customerPhone},notes:{address:e.customerAddress},theme:{color:"#322a2b"},handler:e=>{console.log("Payment successful:",e),this.handlePaymentSuccess(e),t(!0)},modal:{ondismiss:()=>{console.log("Payment modal dismissed"),this.handlePaymentCancelled(),a(Error("Payment cancelled by user"))}}};new window.Razorpay(n).open()}catch(e){console.error("Error initializing Razorpay payment:",e),a(e)}})}handlePaymentSuccess(e){let t=new CustomEvent("razorpay-payment-success",{detail:e});window.dispatchEvent(t)}handlePaymentCancelled(){let e=new CustomEvent("razorpay-payment-cancelled");window.dispatchEvent(e)}async createOrder(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"INR";if(!this.isConfigured)throw Error("Razorpay is not configured");try{let a=await fetch("/api/razorpay/create-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:100*e,currency:t})});if(!a.ok)throw Error("Failed to create order");return(await a.json()).orderId}catch(e){return console.error("Error creating order:",e),"order_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}}async verifyPayment(e,t,a){if(!this.isConfigured)throw Error("Razorpay is not configured");try{let n=await fetch("/api/razorpay/verify-payment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paymentId:e,orderId:t,signature:a})});if(!n.ok)throw Error("Payment verification failed");return(await n.json()).verified}catch(e){return console.error("Error verifying payment:",e),!1}}loadRazorpayScript(){return new Promise((e,t)=>{if(window.Razorpay)return void e();let a=document.createElement("script");a.src="https://checkout.razorpay.com/v1/checkout.js",a.onload=()=>e(),a.onerror=()=>t(Error("Failed to load Razorpay script")),document.head.appendChild(a)})}getPaymentMethods(){return["card","netbanking","wallet","upi","paylater"]}formatAmount(e){return new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR"}).format(e)}getSupportedCurrencies(){return["INR","USD","EUR","GBP"]}getPaymentHistory(){return[]}async testPayment(){return new Promise(e=>{setTimeout(()=>{e({success:!0,message:"Test payment configuration successful"})},1e3)})}constructor(){this.isConfigured=!1,this.config=null,this.checkConfiguration()}}let ee=new $;function et(e){let{totalAmount:t,onPaymentSuccess:a,onPaymentError:s,bookingData:d}=e,[u,h]=(0,r.useState)("card"),[y,f]=(0,r.useState)({cardNumber:"",cardHolder:"",expiryMonth:"",expiryYear:"",cvv:""}),[A,j]=(0,r.useState)({upiId:""}),[b,v]=(0,r.useState)({accountNumber:"",ifscCode:"",accountHolder:""}),[N,D]=(0,r.useState)(!1),[P,E]=(0,r.useState)(!1),O=new Date().getFullYear(),M=Array.from({length:10},(e,t)=>O+t),R=Array.from({length:12},(e,t)=>String(t+1).padStart(2,"0"));(0,r.useEffect)(()=>{E(!1);let e=e=>{a(e.detail)},t=e=>{s("Payment was cancelled by user.")};return window.addEventListener("razorpay-payment-success",e),window.addEventListener("razorpay-payment-cancelled",t),()=>{window.removeEventListener("razorpay-payment-success",e),window.removeEventListener("razorpay-payment-cancelled",t)}},[a,s]);let W=(e,t)=>{f(a=>({...a,[e]:t}))},B=(e,t)=>{v(a=>({...a,[e]:t}))},T=async()=>{D(!0);try{if("razorpay"===u){if(!P){s("Razorpay is not configured. Please contact administrator."),D(!1);return}if(!d){s("Booking data is required for payment."),D(!1);return}await ee.initializePayment({amount:t,currency:"INR",name:"Luxe Staycations",description:"Booking for ".concat(d.propertyName),orderId:d.bookingId||"order_".concat(Date.now()),customerName:d.guestName,customerEmail:d.guestEmail,customerPhone:d.guestPhone,customerAddress:""})||s("Failed to initialize payment"),D(!1);return}let e=null;switch(u){case"card":e=!y.cardNumber||y.cardNumber.length<16?"Please enter a valid card number":y.cardHolder?y.expiryMonth&&y.expiryYear?!y.cvv||y.cvv.length<3?"Please enter a valid CVV":null:"Please select expiry date":"Please enter card holder name";break;case"upi":e=A.upiId&&A.upiId.includes("@")?null:"Please enter a valid UPI ID";break;case"bank":e=!b.accountNumber||b.accountNumber.length<10?"Please enter a valid account number":!b.ifscCode||b.ifscCode.length<4?"Please enter a valid IFSC code":b.accountHolder?null:"Please enter account holder name";break;default:e="Please select a payment method"}if(e){s(e),D(!1);return}await new Promise(e=>setTimeout(e,2e3));let n={method:u,amount:t,transactionId:"TXN_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),status:"success",timestamp:new Date().toISOString(),details:"card"===u?y:"upi"===u?A:b};a(n)}catch(e){s("Payment processing failed. Please try again.")}finally{D(!1)}};return(0,n.jsxs)(c.A,{sx:{p:3},children:[(0,n.jsx)(i.A,{variant:"h6",sx:{mb:3,fontWeight:600,color:"#5a3d35"},children:"Payment Information"}),(0,n.jsxs)(o.A,{severity:"info",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(H.A,{}),"Test Mode: Using manual payment methods for testing. Razorpay temporarily disabled."]}),(0,n.jsx)(x.A,{sx:{mb:3,border:"2px solid #f3f4f6"},children:(0,n.jsxs)(g.A,{children:[(0,n.jsx)(U.A,{component:"legend",sx:{mb:2,fontWeight:600,color:"#d97706"},children:"Select Payment Method"}),(0,n.jsxs)(G.A,{value:u,onChange:e=>h(e.target.value),children:[(0,n.jsx)(C.A,{value:"card",control:(0,n.jsx)(Y.A,{}),label:(0,n.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(V.A,{}),(0,n.jsx)(i.A,{children:"Credit/Debit Card (Recommended)"}),(0,n.jsx)(z.A,{icon:(0,n.jsx)(H.A,{}),label:"Secure",size:"small",color:"success",variant:"outlined"})]})}),(0,n.jsx)(C.A,{value:"upi",control:(0,n.jsx)(Y.A,{}),label:(0,n.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(q.A,{}),(0,n.jsx)(i.A,{children:"UPI Payment (Manual)"})]})}),(0,n.jsx)(C.A,{value:"bank",control:(0,n.jsx)(Y.A,{}),label:(0,n.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(K.A,{}),(0,n.jsx)(i.A,{children:"Net Banking (Manual)"})]})})]})]})}),"card"===u&&(0,n.jsx)(x.A,{sx:{mb:3,border:"2px solid #f3f4f6"},children:(0,n.jsxs)(g.A,{children:[(0,n.jsxs)(i.A,{variant:"h6",sx:{mb:2,fontWeight:600,color:"#d97706",display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(V.A,{}),"Card Details"]}),(0,n.jsxs)(m.Ay,{container:!0,spacing:2,children:[(0,n.jsx)(m.Ay,{item:!0,xs:12,children:(0,n.jsx)(p.A,{fullWidth:!0,label:"Card Number",value:y.cardNumber,onChange:e=>W("cardNumber",e.target.value.replace(/\D/g,"").slice(0,16)),placeholder:"1234 5678 9012 3456",inputProps:{maxLength:16}})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,children:(0,n.jsx)(p.A,{fullWidth:!0,label:"Card Holder Name",value:y.cardHolder,onChange:e=>W("cardHolder",e.target.value),placeholder:"JOHN DOE"})}),(0,n.jsx)(m.Ay,{item:!0,xs:6,children:(0,n.jsxs)(k.A,{fullWidth:!0,children:[(0,n.jsx)(I.A,{children:"Expiry Month"}),(0,n.jsx)(w.A,{value:y.expiryMonth,onChange:e=>W("expiryMonth",e.target.value),label:"Expiry Month",children:R.map(e=>(0,n.jsx)(S.A,{value:e,children:e},e))})]})}),(0,n.jsx)(m.Ay,{item:!0,xs:6,children:(0,n.jsxs)(k.A,{fullWidth:!0,children:[(0,n.jsx)(I.A,{children:"Expiry Year"}),(0,n.jsx)(w.A,{value:y.expiryYear,onChange:e=>W("expiryYear",e.target.value),label:"Expiry Year",children:M.map(e=>(0,n.jsx)(S.A,{value:e,children:e},e))})]})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,children:(0,n.jsx)(p.A,{fullWidth:!0,label:"CVV",value:y.cvv,onChange:e=>W("cvv",e.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"123",inputProps:{maxLength:4}})})]})]})}),"upi"===u&&(0,n.jsx)(x.A,{sx:{mb:3,border:"2px solid #f3f4f6"},children:(0,n.jsxs)(g.A,{children:[(0,n.jsxs)(i.A,{variant:"h6",sx:{mb:2,fontWeight:600,color:"#d97706",display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(q.A,{}),"UPI Payment"]}),(0,n.jsx)(p.A,{fullWidth:!0,label:"UPI ID",value:A.upiId,onChange:e=>{var t;return t=e.target.value,void j(e=>({...e,upiId:t}))},placeholder:"username@upi",helperText:"Enter your UPI ID (e.g., john@okicici)"})]})}),"bank"===u&&(0,n.jsx)(x.A,{sx:{mb:3,border:"2px solid #f3f4f6"},children:(0,n.jsxs)(g.A,{children:[(0,n.jsxs)(i.A,{variant:"h6",sx:{mb:2,fontWeight:600,color:"#d97706",display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(K.A,{}),"Net Banking"]}),(0,n.jsxs)(m.Ay,{container:!0,spacing:2,children:[(0,n.jsx)(m.Ay,{item:!0,xs:12,children:(0,n.jsx)(p.A,{fullWidth:!0,label:"Account Number",value:b.accountNumber,onChange:e=>B("accountNumber",e.target.value.replace(/\D/g,"")),placeholder:"1234567890"})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,children:(0,n.jsx)(p.A,{fullWidth:!0,label:"IFSC Code",value:b.ifscCode,onChange:e=>B("ifscCode",e.target.value.toUpperCase()),placeholder:"SBIN0001234"})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,children:(0,n.jsx)(p.A,{fullWidth:!0,label:"Account Holder Name",value:b.accountHolder,onChange:e=>B("accountHolder",e.target.value),placeholder:"JOHN DOE"})})]})]})}),(0,n.jsxs)(o.A,{severity:"info",sx:{mb:3,display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(Z.A,{}),"Your payment information is secure and encrypted. We use industry-standard SSL encryption."]}),(0,n.jsx)(l.A,{fullWidth:!0,variant:"contained",onClick:T,disabled:N,sx:{py:2,background:"linear-gradient(45deg, #5a3d35, #d97706)","&:hover":{background:"linear-gradient(45deg, #4a332c, #b45309)"}},children:N?(0,n.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(X.A,{}),"Processing Payment..."]}):(0,n.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(q.A,{}),"Pay ₹",t.toLocaleString()]})})]})}let ea=["Guest Information","Booking Summary","Payment"];function en(){var e;let t=(0,j.useRouter)(),a=(0,j.useSearchParams)(),{bookingDetails:k,setBookingDetails:I,guestInfo:w,setGuestInfo:S,searchFormData:C,setSearchFormData:N,addBooking:D,syncToAdminDashboard:P}=(0,b.s)(),[E,O]=(0,r.useState)(0),[M,R]=(0,r.useState)(null),[W,z]=(0,r.useState)(!0),[T,_]=(0,r.useState)({open:!1,message:"",severity:"success"}),[L,F]=(0,r.useState)(""),[q,U]=(0,r.useState)(null),[G,Y]=(0,r.useState)(0),[H,V]=(0,r.useState)(""),[K,Z]=(0,r.useState)([]);(0,r.useEffect)(()=>{(async()=>{try{let e=a.get("property");if(e){v.propertyManager.initialize();let t=await v.propertyManager.getById(e);R(t||null)}z(!1)}catch(e){console.error("Error loading property:",e),z(!1)}})()},[a]),(0,r.useEffect)(()=>{(async()=>{try{await v.dealManager.initialize();let e=(await v.dealManager.getAll()).filter(e=>{let t=new Date,a=new Date(e.startDate||new Date),n=new Date(e.endDate||new Date);return e.isActive&&t>=a&&t<=n});Z(e)}catch(e){console.error("Error loading deals:",e)}})()},[]),(0,r.useEffect)(()=>{console.log("Checkout page - searchFormData:",C),console.log("Checkout page - property:",M),console.log("Checkout page - current bookingDetails:",k),C&&M?(()=>{var e;let t=new Date(C.checkIn),a=Math.ceil(Math.abs(new Date(C.checkOut).getTime()-t.getTime())/864e5),n=a*M.price,r={checkIn:C.checkIn,checkOut:C.checkOut,guests:C.guests,totalNights:a,total:n,property_id:M.id,propertyName:M.name,propertyLocation:M.location,propertyImage:(null==(e=M.images)?void 0:e[0])||"",propertyPrice:M.price};I(r),console.log("Booking details calculated and set:",r)})():console.log("Missing data for booking calculation:",{hasSearchFormData:!!C,hasProperty:!!M,searchFormDataKeys:C?Object.keys(C):[],propertyKeys:M?Object.keys(M):[]})},[C,M,I]);let X=async(e,t,a)=>{try{let n=await fetch("/api/guest/create-from-booking",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:t.firstName,lastName:t.lastName,email:t.email,phone:t.phone,bookingId:e.id,propertyName:e.bookingDetails.propertyName,totalAmount:e.bookingDetails.total,subscribeToNewsletter:t.subscribeToNewsletter||!1,loyaltyPoints:a})}),r=await n.json();if(r.success){console.log("Loyalty account created successfully:",r);try{await fetch("/api/brevo/loyalty",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({guestName:"".concat(t.firstName," ").concat(t.lastName),guestEmail:t.email,currentPoints:a,rewardsDashboardLink:"".concat("https://silly-banoffee-445ea8.netlify.app","/guest/dashboard")})})}catch(e){console.error("Error sending loyalty welcome email:",e)}}else console.error("Failed to create loyalty account:",r.message)}catch(e){throw console.error("Error creating loyalty account:",e),e}},Q=async e=>{try{var a,n;if(!M||!k||!C)throw Error("Missing property, booking details, or search data");let r=k.total||0,s=.1*r,i=r+s,o=Math.max(0,i-G),l=Math.floor(k.total/100),c={id:"booking_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),guestInfo:{...w},bookingDetails:{...k,property_id:M.id,propertyName:M.name,propertyLocation:M.location,propertyImage:(null==(a=M.images)?void 0:a[0])||"",propertyPrice:M.price},searchFormData:C,status:"confirmed",createdAt:new Date().toISOString(),loyaltyPoints:l,jewelsEarned:l,loyaltyAccountCreated:w.createLoyaltyAccount||!1,updatedAt:new Date().toISOString(),paymentStatus:"paid",paymentMethod:e.method,transactionId:e.transactionId,paymentDetails:{...e,finalAmount:o,couponDiscount:G,couponCode:q?L:void 0,baseAmount:r,serviceFee:s,subtotal:i}};if(await D(c),q&&L)try{let e=await v.couponManagerInstance.redeemCoupon(L,k.total||0,c.id,w.email,"".concat(w.firstName," ").concat(w.lastName));console.log("Coupon redeemed:",e)}catch(e){console.error("Error redeeming coupon:",e)}await v.bookingManager.initialize();let d=await v.bookingManager.create({id:Date.now().toString(),property_id:M.id,user_id:"guest",guestName:"".concat(w.firstName," ").concat(w.lastName),guestEmail:w.email,guestPhone:w.phone,checkIn:k.checkIn,checkOut:k.checkOut,guests:parseInt(k.guests),totalAmount:k.total,status:"confirmed",specialRequests:w.specialRequests||"",created_at:new Date().toISOString(),updated_at:new Date().toISOString()});console.log("Supabase booking created:",d),P();try{let t={guestName:"".concat(w.firstName," ").concat(w.lastName),guestEmail:w.email,bookingId:c.id,propertyName:M.name,propertyLocation:M.location,checkIn:k.checkIn,checkOut:k.checkOut,guests:k.guests,totalAmount:k.total,transactionId:e.transactionId,paymentMethod:e.method,specialRequests:(null==(n=c.guestInfo)?void 0:n.specialRequests)||""};console.log("Sending booking confirmation email via Brevo...");let a=await fetch("/api/brevo/booking-confirmation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await a.json();r.success?console.log("\uD83D\uDCE7 Booking confirmation email sent successfully to",w.email,"MessageId:",r.messageId):console.warn("⚠️ Booking confirmation email failed:",r.message)}catch(e){console.error("Error sending booking confirmation email:",e)}if(_({open:!0,message:"Payment successful! Booking confirmed and confirmation email sent.",severity:"success"}),w.createLoyaltyAccount)try{await X(c,w,l)}catch(e){console.error("Error creating loyalty account:",e)}setTimeout(()=>{t.push("/booking/confirmation/".concat(c.id))},1500)}catch(e){console.error("Error creating booking:",e),_({open:!0,message:"Error creating booking. Please try again.",severity:"error"})}},$=async()=>{if(!L.trim())return void V("Please enter a coupon code");try{let e=k.total||0,t=await v.couponManagerInstance.validateCoupon(L,e);if(!t.isValid)return void V(t.message);let a=t.banner,n={id:a.id,title:a.title,description:a.description||"",subtitle:"".concat(a.discountValue).concat("percentage"===a.discountType?"%":"₹"," off"),image:a.image||"",link:a.link||"",buttonText:"Applied",buttonLink:a.buttonLink,fallbackImageUrl:a.backgroundImageUrl,isActive:a.isActive,startDate:a.startDate||new Date().toISOString(),endDate:a.endDate||new Date().toISOString(),created_at:a.created_at,updated_at:a.updated_at};U(n),Y(t.discount),V(""),_({open:!0,message:t.message,severity:"success"})}catch(e){console.error("Error validating coupon:",e),V("Error validating coupon. Please try again.")}},ee=e=>Math.max(0,e+.1*e-G);return W?(0,n.jsx)(s.A,{maxWidth:"lg",sx:{py:8},children:(0,n.jsx)(i.A,{children:"Loading booking information..."})}):M&&k?(0,n.jsxs)(s.A,{maxWidth:"lg",sx:{py:8},children:[(0,n.jsx)(c.A,{sx:{mb:6},children:(0,n.jsx)(d.A,{activeStep:E,alternativeLabel:!0,children:ea.map(e=>(0,n.jsx)(u.A,{children:(0,n.jsx)(h.A,{children:e})},e))})}),(0,n.jsxs)(m.Ay,{container:!0,spacing:4,children:[(0,n.jsxs)(m.Ay,{item:!0,xs:12,md:8,children:[0===E&&(0,n.jsx)(x.A,{children:(0,n.jsx)(g.A,{children:(0,n.jsx)(B,{guestInfo:w,onGuestInfoChange:(e,t)=>{S({...w,[e]:t})}})})}),1===E&&(0,n.jsx)(x.A,{children:(0,n.jsx)(g.A,{children:(0,n.jsx)(J,{guestInfo:w,bookingDetails:k,property:M})})}),2===E&&(0,n.jsx)(x.A,{children:(0,n.jsx)(g.A,{children:(0,n.jsx)(et,{totalAmount:ee(k.total||0),onPaymentSuccess:Q,onPaymentError:e=>{_({open:!0,message:e,severity:"error"})},bookingData:{bookingId:"temp-".concat(Date.now()),guestName:"".concat(w.firstName," ").concat(w.lastName),propertyName:M.name,guestEmail:w.email,guestPhone:w.phone}})})})]}),(0,n.jsx)(m.Ay,{item:!0,xs:12,md:4,children:(0,n.jsx)(x.A,{sx:{position:"sticky",top:100},children:(0,n.jsxs)(g.A,{children:[(0,n.jsx)(i.A,{variant:"h6",sx:{mb:3},children:"Booking Summary"}),(0,n.jsxs)(c.A,{sx:{mb:3},children:[(0,n.jsx)("img",{src:(null==(e=M.images)?void 0:e[0])||"https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=800&q=80",alt:M.name,style:{width:"100%",height:150,objectFit:"cover",borderRadius:8}}),(0,n.jsx)(i.A,{variant:"h6",sx:{mt:2,mb:1},children:M.name}),(0,n.jsx)(i.A,{variant:"body2",sx:{color:"text.secondary",mb:2},children:M.location})]}),(0,n.jsxs)(c.A,{sx:{mb:3},children:[(0,n.jsx)(i.A,{variant:"subtitle2",sx:{mb:2,fontWeight:600},children:"Modify Dates"}),(0,n.jsxs)(m.Ay,{container:!0,spacing:2,children:[(0,n.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,n.jsx)(p.A,{fullWidth:!0,type:"date",label:"Check-in Date",value:(null==C?void 0:C.checkIn)||"",onChange:e=>{if(N({destination:(null==C?void 0:C.destination)||"",checkIn:e.target.value,checkOut:(null==C?void 0:C.checkOut)||"",guests:(null==C?void 0:C.guests)||"1",amenities:(null==C?void 0:C.amenities)||[]}),e.target.value&&(null==C?void 0:C.checkOut)){let t=new Date(e.target.value),a=Math.ceil(Math.abs(new Date(C.checkOut).getTime()-t.getTime())/864e5),n=a*M.price;I({...k,checkIn:e.target.value,totalNights:a,total:n})}},InputLabelProps:{shrink:!0}})}),(0,n.jsx)(m.Ay,{item:!0,xs:12,sm:6,children:(0,n.jsx)(p.A,{fullWidth:!0,type:"date",label:"Check-out Date",value:(null==C?void 0:C.checkOut)||"",onChange:e=>{if(N({destination:(null==C?void 0:C.destination)||"",checkIn:(null==C?void 0:C.checkIn)||"",checkOut:e.target.value,guests:(null==C?void 0:C.guests)||"1",amenities:(null==C?void 0:C.amenities)||[]}),(null==C?void 0:C.checkIn)&&e.target.value){let t=new Date(C.checkIn),a=Math.ceil(Math.abs(new Date(e.target.value).getTime()-t.getTime())/864e5),n=a*M.price;I({...k,checkOut:e.target.value,totalNights:a,total:n})}},InputLabelProps:{shrink:!0}})})]})]}),(0,n.jsx)(y.A,{sx:{my:2}}),(0,n.jsxs)(c.A,{sx:{mb:3},children:[(0,n.jsxs)(i.A,{variant:"subtitle2",sx:{mb:2,display:"flex",alignItems:"center",gap:1},children:[(0,n.jsx)(A.A,{}),"Coupon Code"]}),q?(0,n.jsxs)(c.A,{sx:{p:2,backgroundColor:"success.light",borderRadius:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,n.jsxs)(c.A,{children:[(0,n.jsxs)(i.A,{variant:"body2",sx:{fontWeight:600,color:"success.dark"},children:[q.id," Applied"]}),(0,n.jsx)(i.A,{variant:"caption",sx:{color:"success.dark"},children:q.subtitle})]}),(0,n.jsx)(l.A,{size:"small",onClick:()=>{U(null),Y(0),F(""),V("")},sx:{color:"success.dark",minWidth:"auto"},children:"Remove"})]}):(0,n.jsxs)(c.A,{sx:{display:"flex",gap:1},children:[(0,n.jsx)(p.A,{size:"small",placeholder:"Enter coupon code",value:L,onChange:e=>{F(e.target.value),V("")},error:!!H,helperText:H,sx:{flexGrow:1}}),(0,n.jsx)(l.A,{variant:"outlined",onClick:$,disabled:!L.trim(),sx:{borderColor:"var(--primary-light)",color:"var(--primary-dark)","&:hover":{backgroundColor:"var(--primary-light)",color:"white",borderColor:"var(--primary-light)"}},children:"Apply"})]})]}),(()=>{let e=k.totalNights||0,t=k.total||0;if(0===e&&C&&M){let a=new Date(C.checkIn);t=(e=Math.ceil(Math.abs(new Date(C.checkOut).getTime()-a.getTime())/864e5))*M.price}let a=.1*t;return(0,n.jsxs)(c.A,{sx:{mb:2},children:[(0,n.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,n.jsx)(i.A,{variant:"body2",children:"Price per night"}),(0,n.jsxs)(i.A,{variant:"body2",children:["₹",M.price.toLocaleString()]})]}),(0,n.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,n.jsx)(i.A,{variant:"body2",children:"Number of nights"}),(0,n.jsx)(i.A,{variant:"body2",children:e})]}),(0,n.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,n.jsx)(i.A,{variant:"body2",children:"Subtotal"}),(0,n.jsxs)(i.A,{variant:"body2",children:["₹",t.toLocaleString()]})]}),(0,n.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,n.jsx)(i.A,{variant:"body2",children:"Service fee"}),(0,n.jsxs)(i.A,{variant:"body2",children:["₹",a.toLocaleString()]})]}),q&&(0,n.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between",mb:1},children:[(0,n.jsxs)(i.A,{variant:"body2",sx:{color:"success.main"},children:["Discount (",q.id,")"]}),(0,n.jsxs)(i.A,{variant:"body2",sx:{color:"success.main"},children:["-₹",G.toLocaleString()]})]})]})})(),(0,n.jsx)(y.A,{sx:{my:2}}),(()=>{let e=k.totalNights||0,t=k.total||0;if(0===e&&C&&M){let a=new Date(C.checkIn);t=(e=Math.ceil(Math.abs(new Date(C.checkOut).getTime()-a.getTime())/864e5))*M.price}let a=ee(t);return(0,n.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between",mb:3},children:[(0,n.jsx)(i.A,{variant:"h6",children:"Total"}),(0,n.jsxs)(i.A,{variant:"h6",sx:{color:"#d97706"},children:["₹",a.toLocaleString()]})]})})(),(0,n.jsxs)(c.A,{sx:{display:"flex",gap:2},children:[E>0&&(0,n.jsx)(l.A,{variant:"outlined",onClick:()=>{O(e=>e-1)},sx:{flex:1},children:"Back"}),(0,n.jsx)(l.A,{variant:"contained",onClick:()=>{if(0===E&&(!w.firstName||!w.lastName||!w.email||!w.phone))return void _({open:!0,message:"Please fill in all guest information fields",severity:"error"});O(e=>e+1)},disabled:E===ea.length-1,sx:{flex:1,background:"linear-gradient(45deg, #5a3d35, #d97706)","&:hover":{background:"linear-gradient(45deg, #4a332c, #b45309)"}},children:E===ea.length-1?"Payment Required":"Next"})]})]})})})]}),(0,n.jsx)(f.A,{open:T.open,autoHideDuration:6e3,onClose:()=>_({...T,open:!1}),children:(0,n.jsx)(o.A,{onClose:()=>_({...T,open:!1}),severity:T.severity,sx:{width:"100%"},children:T.message})})]}):(0,n.jsxs)(s.A,{maxWidth:"lg",sx:{py:8},children:[(0,n.jsx)(o.A,{severity:"error",children:"Booking information not found. Please start a new booking."}),(0,n.jsx)(l.A,{variant:"contained",onClick:()=>t.push("/villas"),sx:{mt:2},children:"Browse Properties"})]})}function er(){return(0,n.jsx)(r.Suspense,{fallback:(0,n.jsx)("div",{children:"Loading..."}),children:(0,n.jsx)(en,{})})}},85903:(e,t,a)=>{"use strict";a.d(t,{s:()=>o,v:()=>i});var n=a(95155),r=a(12115);let s=(0,r.createContext)(void 0);function i(e){let{children:t}=e,[i,o]=(0,r.useState)(null),[l,c]=(0,r.useState)({firstName:"",lastName:"",email:"",phone:"",address:"",city:"",country:"",specialRequests:""}),[d,u]=(0,r.useState)({checkIn:"",checkOut:"",guests:"",totalNights:0,total:0,propertyId:"",propertyName:"",propertyLocation:"",propertyImage:"",propertyPrice:0}),[h,m]=(0,r.useState)(null),[x,g]=(0,r.useState)([]);(0,r.useEffect)(()=>{{let e=localStorage.getItem("luxeBookings");if(e)try{g(JSON.parse(e))}catch(e){console.error("Error loading bookings from localStorage:",e)}}},[]),(0,r.useEffect)(()=>{localStorage.setItem("luxeBookings",JSON.stringify(x))},[x]);let p=async e=>{g(t=>[...t,e]),console.log("Booking added:",e);try{let t=await fetch("/api/bookings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({guestName:"".concat(e.guestInfo.firstName," ").concat(e.guestInfo.lastName),guestEmail:e.guestInfo.email,guestPhone:e.guestInfo.phone,propertyId:e.bookingDetails.propertyId,propertyName:e.bookingDetails.propertyName,checkIn:e.bookingDetails.checkIn,checkOut:e.bookingDetails.checkOut,guests:parseInt(e.bookingDetails.guests),amount:e.bookingDetails.total,status:e.status,paymentStatus:e.paymentStatus,specialRequests:e.guestInfo.specialRequests})});if(t.ok){let e=await t.json();console.log("Booking saved to Supabase:",e)}else console.error("Failed to save booking to Supabase:",await t.text())}catch(e){console.error("Error saving booking to Supabase:",e)}};return(0,n.jsx)(s.Provider,{value:{searchFormData:i,setSearchFormData:o,guestInfo:l,setGuestInfo:c,bookingDetails:d,setBookingDetails:u,completeBooking:h,setCompleteBooking:m,allBookings:x,addBooking:p,updateBooking:(e,t)=>{g(a=>a.map(a=>a.id===e?{...a,...t,updatedAt:new Date().toISOString()}:a)),console.log("Booking updated:",e,t),a.e(8991).then(a.bind(a,68991)).then(async a=>{let{bookingManager:n}=a;try{let a=await n.getById(e);if(a){var r,s,i,o,l,c,d,u;n.update(e,{guestName:t.guestInfo?"".concat(t.guestInfo.firstName||""," ").concat(t.guestInfo.lastName||"").trim():a.guestName,guestEmail:(null==(r=t.guestInfo)?void 0:r.email)||a.guestEmail,guestPhone:(null==(s=t.guestInfo)?void 0:s.phone)||a.guestPhone,property_id:(null==(i=t.bookingDetails)?void 0:i.propertyId)||a.property_id,checkIn:(null==(o=t.bookingDetails)?void 0:o.checkIn)||a.checkIn,checkOut:(null==(l=t.bookingDetails)?void 0:l.checkOut)||a.checkOut,guests:(null==(c=t.bookingDetails)?void 0:c.guests)?parseInt(t.bookingDetails.guests):"string"==typeof a.guests?parseInt(a.guests):a.guests,totalAmount:(null==(d=t.bookingDetails)?void 0:d.total)||a.totalAmount,status:"confirmed",specialRequests:(null==(u=t.guestInfo)?void 0:u.specialRequests)||a.specialRequests||""}),console.log("Successfully synced booking update to admin dashboard via DataManager")}}catch(e){console.error("Error syncing booking update to admin dashboard:",e)}})},getBookingById:e=>x.find(t=>t.id===e),clearBookingData:()=>{o(null),c({firstName:"",lastName:"",email:"",phone:"",address:"",city:"",country:"",specialRequests:""}),u({checkIn:"",checkOut:"",guests:"",totalNights:0,total:0,propertyId:"",propertyName:"",propertyLocation:"",propertyImage:"",propertyPrice:0}),m(null)},syncToAdminDashboard:()=>{console.log("Syncing booking data to admin dashboard..."),console.log("DataManager automatically handles Supabase sync and real-time updates")}},children:t})}function o(){let e=(0,r.useContext)(s);if(void 0===e)throw Error("useBookingContext must be used within a BookingProvider");return e}}},e=>{e.O(0,[5446,134,5493,5436,3077,8548,8020,2403,9562,4211,422,3568,7922,5979,3357,8441,1255,7358],()=>e(e.s=53082)),_N_E=e.O()}]);